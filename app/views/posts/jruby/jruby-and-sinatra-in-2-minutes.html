*{META
title: 'JRuby and Sinatra in 2 Minutes'
summary: A lightning fast walkthrough of using the Sinatra micro-web-framework with JRuby as the platform.
tags: JRuby,Bundler,Sinatra,glassfish,Ruby
brushes: bash,ruby,text
category: journal
date: 7/17/2010 11:53
legacyId: 591
META}*
While at <a href="http://www.rubymidwest.com">RubyMidwest</a> I decided to explore <a href="http://www.sinatrarb.com/">Sinatra</a> in more detail. I've spent a lot of time with <a href="http://www.rubyonrails.org">Rails</a>, and while I love it, there is something alluring about the simplicity of Sinatra (and, well... ooh shiny). Being a recovering Java developer (Hi, I'm R.J., and I haven't developed in Java for 18 hours) I have a server that runs Java, and would like to be able to use Sinatra to build my fancy-awesome web-apps. On those lines, I want all of the shiny benefits of <a href="http://www.jruby.org">JRuby's</a> multi-threading awesome-ness, as opposed to just trying to use WEBrick, which does not a powerful server make. So here is a 2 minute tutorial (well, depending on the performance of your computer, and how fast you type) startup with <a href="http://www.sinatrarb.com">Sinatra</a>, <a href="http://www.jruby.org">JRuby</a>, <a href="http://www.gembundler.com">Bundler</a>, and <a href="http://wiki.glassfish.java.net/Wiki.jsp?page=JRuby">Glassfish</a>.

I'm cheating already by assuming you already have JRuby installed as your default Ruby installation. No? <a href="http://www.jruby.org">Go get it!</a>

Next step is to get bundler:

#{code 'bash'}
gem install bundler
#{/code}

Now we need to make a home for our application, and prep it for Bundler:
#{code 'bash'}
mkdir testapp
cd testapp
edit Gemfile
#{/code}

Here I'm creating a new file in testapp called 'Gemfile' in your favorite editor. This is where we will sketch out our dependencies for Bundler to do all the hard work for us - here are the contents for this example:

#{code 'text'}
source :rubygems
gem "sinatra"
gem "glassfish"
#{/code}

Frankly, that's it. We tell Bundler to look for gems in RubyGems core repo, and then we ask it to make sure we have Sinatra and Glassfish. Now we can create the program - create the file 'hello.rb', and use these contents:

#{code 'ruby'}
require "rubygems"
require "bundler"
Bundler.setup

require "sinatra"

get '/hi' do
	"Hello World!"
end
#{/code}

So what's special for JRuby? Absolutely nothing. We do have special sauce for Bundler, (by calling Bundler.setup prior to the require for 'sinatra') but trust me - you'll be happy you used it. You'll also make <a href="http://www.twitter.com/wycats">@wycats</a> happy.

And - that's it! Now, if you were to start this file the standard (well, bundler-standard) way, we'll see this:

#{code 'bash'}
realjenius$ bundle exec hello.rb
== Sinatra/1.0 has taken the stage on 4567 for development with backup from WEBrick
[2010-07-17 11:24:46] INFO  WEBrick 1.3.1
[2010-07-17 11:24:46] INFO  ruby 1.8.7 (2010-06-06) [java]
[2010-07-17 11:24:46] INFO  WEBrick::HTTPServer#start: pid=44490 port=4567
#{/code}

...and we can visit this URL: <a href="http://localhost:4567/hi">http://localhost:4567/hi</a>. But, recall that our goal was to work with Glassfish, not WEBrick. All that has to change (and for folks who has done Glassfish/Rails before, this won't be a surprise) is to run this startup instead

#{code 'bash'}
realjenius$ bundle exec glassfish
Log file /Users/realjenius/Projects/testapp/log/development.log does not exist. Creating a new one...
Starting GlassFish server at: 0.0.0.0:3000 in development environment...
Writing log messages to: /Users/realjenius/Projects/testapp/log/development.log.
Press Ctrl+C to stop.

Running sinatra
#{/code}

This time, we'll visit this URL: <a href="http://localhost:3000/hi">http://localhost:3000/hi</a>, and if all worked as desired, Sinatra will be crooning away. Boom goes the dynamite.